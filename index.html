<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>KL 3D Buildings</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js'></script>
    <link href='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css' rel='stylesheet' />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        #startBtn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            background: rgba(15,93,244,0.9);
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            z-index: 1;
            transition: all 0.3s;
        }
        #startBtn:hover {
            background: rgba(33,200,117,0.9);
        }
    </style>
</head>
<body>
<button id="startBtn" onclick="startTour()">▶ Start Tour</button>
<div id="map"></div>
<script>
    const map = new maplibregl.Map({
        container: 'map',
        style: 'https://tiles.openfreemap.org/styles/liberty',
        center: [101.6941, 3.1466],
        zoom: 14,
        pitch: 50,
        bearing: 0
    });

    // Key viewpoints across KL skyline
    const viewpoints = [
        { coordinates: [101.6941, 3.1466], zoom: 14, pitch: 50, bearing: 0 },    // Dayabumi area
        { coordinates: [101.7000, 3.1500], zoom: 14.2, pitch: 52, bearing: 30 },  // Transition
        { coordinates: [101.7034, 3.1529], zoom: 14, pitch: 55, bearing: -20 },   // KL Tower area
        { coordinates: [101.7075, 3.1554], zoom: 14.2, pitch: 50, bearing: 10 },  // Transition
        { coordinates: [101.7116, 3.1579], zoom: 14, pitch: 52, bearing: 40 },    // KLCC area
        { coordinates: [101.7151, 3.1497], zoom: 14.2, pitch: 55, bearing: -30 }, // Transition
        { coordinates: [101.7186, 3.1415], zoom: 14, pitch: 50, bearing: -45 },   // TRX area
        { coordinates: [101.7095, 3.1401], zoom: 14.2, pitch: 52, bearing: 20 },  // Transition
        { coordinates: [101.7004, 3.1387], zoom: 14, pitch: 55, bearing: 10 }     // Merdeka area
    ];

    let currentIndex = 0;
    let tourRunning = false;

    map.on('load', () => {
        // Add 3D buildings with solid colors (no fade effect)
        map.addLayer({
            'id': '3d-buildings',
            'source': 'openmaptiles',
            'source-layer': 'building',
            'type': 'fill-extrusion',
            'minzoom': 13,
            'paint': {
                'fill-extrusion-color': [
                    'interpolate',
                    ['linear'],
                    ['get', 'render_height'],
                    0, '#21C875',
                    50, '#1BA668',
                    100, '#17855A',
                    150, '#13644C',
                    200, '#0F5DF4',
                    300, '#0A4BC4',
                    450, '#0539A4'
                ],
                'fill-extrusion-height': ['get', 'render_height'],
                'fill-extrusion-base': ['get', 'render_min_height'],
                'fill-extrusion-opacity': 1.0
            }
        });
    });

    function flyToNext() {
        if (!tourRunning || currentIndex >= viewpoints.length) {
            if (currentIndex >= viewpoints.length) {
                // Loop back to start
                currentIndex = 0;
                setTimeout(() => {
                    if (tourRunning) flyToNext();
                }, 1000);
            }
            return;
        }

        const point = viewpoints[currentIndex];
        
        map.flyTo({
            center: point.coordinates,
            zoom: point.zoom,
            pitch: point.pitch,
            bearing: point.bearing,
            duration: 4000,
            essential: true,
            easing: (t) => t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t
        });

        currentIndex++;
        setTimeout(() => {
            if (tourRunning) flyToNext();
        }, 4500);
    }

    function startTour() {
        const btn = document.getElementById('startBtn');
        if (!tourRunning) {
            tourRunning = true;
            currentIndex = 0;
            btn.textContent = '⏸ Pause';
            flyToNext();
        } else {
            tourRunning = false;
            btn.textContent = '▶ Resume';
        }
    }

    map.addControl(new maplibregl.NavigationControl(), 'bottom-right');
</script>
</body>
</html>
